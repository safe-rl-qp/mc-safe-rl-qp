---
# If true, the FSM transitions are managed by an external tool
Managed: false
# If true and the FSM is self-managed, transitions should be triggered
StepByStep: true
# Change idle behaviour, if true the state is kept until transition,
# otherwise the FSM holds the last state until transition
IdleKeepState: false
# Where to look for state libraries
StatesLibraries:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@"
# Where to look for state files
StatesFiles:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@/data"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@/data"
# If true, state factory will be more verbose
VerboseStateFactory: false
# Additional robots to load
robots:
  ground:
    module: env/ground

# Collision constraint
collisions:
- type: collision
  useMinimal: true

# Implement some additional text states
states: 
  PostureDatastoreController_TwoPoints_Exp:
    base: Meta
    Managed: false
    StepByStep: true
    transitions:
      - [PostureDatastoreController_PureRL, FD_f, PostureDatastoreController_FDTask_torque_extForce, Auto]
      - [PostureDatastoreController_FDTask_torque_extForce, FD, PostureDatastoreController_FDTask_torque, Auto]
      - [PostureDatastoreController_FDTask_torque, T_f, PostureDatastoreController_TorqueTask_torque_extForce, Auto]
      - [PostureDatastoreController_TorqueTask_torque_extForce, T, PostureDatastoreController_TorqueTask_torque, Auto]
      - [PostureDatastoreController_TorqueTask_torque, OK, PostureDatastoreController_Initial, Auto]
    
  PostureDatastoreController_Collision_Exp:
    base: Meta
    Managed: false
    StepByStep: true
    transitions:
      - [PostureDatastoreController_DefaultPosture, FD_f, PostureDatastoreController_FDTask_torque_extForce, Auto]
      - [PostureDatastoreController_FDTask_torque_extForce, FD, PostureDatastoreController_FDTask_torque, Auto]
      - [PostureDatastoreController_FDTask_torque, T_f, PostureDatastoreController_TorqueTask_torque_extForce, Auto]
      - [PostureDatastoreController_TorqueTask_torque_extForce, T, PostureDatastoreController_TorqueTask_torque, Auto]
      - [PostureDatastoreController_TorqueTask_torque, OK, PostureDatastoreController_PureRL, Auto]


# Transitions map
transitions:
  - [PostureDatastoreController_TorqueTask_torque, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_TorqueTask_torque_extForce, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_TorqueTask_pos, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_FDTask_torque, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_FDTask_torque_extForce, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_FDTask_pos, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_PureRL, OK, PostureDatastoreController_Initial, Strict]
  - [PostureDatastoreController_DefaultPosture, OK, PostureDatastoreController_Initial, Strict]

  - [PostureDatastoreController_Initial, TorqueTask_torque, PostureDatastoreController_TorqueTask_torque, Strict]
  - [PostureDatastoreController_Initial, TorqueTask_torque_extForce, PostureDatastoreController_TorqueTask_torque_extForce, Strict]
  - [PostureDatastoreController_Initial, TorqueTask_pos, PostureDatastoreController_TorqueTask_pos, Strict]
  - [PostureDatastoreController_Initial, FDTask_torque, PostureDatastoreController_FDTask_torque, Strict]
  - [PostureDatastoreController_Initial, FDTask_torque_extForce, PostureDatastoreController_FDTask_torque_extForce, Strict]
  - [PostureDatastoreController_Initial, FDTask_pos, PostureDatastoreController_FDTask_pos, Strict]
  - [PostureDatastoreController_Initial, PureRL, PostureDatastoreController_PureRL, Strict]
  - [PostureDatastoreController_Initial, TwoPoints_Exp, PostureDatastoreController_TwoPoints_Exp, Strict]
  - [PostureDatastoreController_Initial, DefaultPosture, PostureDatastoreController_DefaultPosture, Strict]
  - [PostureDatastoreController_Initial, Collision_Exp, PostureDatastoreController_Collision_Exp, Strict]

# Initial state
init: PostureDatastoreController_Initial

Plugins: [RosPosturePubSub, ExternalForcesEstimator]

ObserverPipelines:
  - name: Pipeline
    observers:
      - type: Encoder
        config:
          velocity: encoderVelocities

kp_policy:
    joint_1: 40.0
    joint_2: 40.0
    joint_3: 40.0
    joint_4: 40.0
    joint_5: 15.0
    joint_6: 15.0
    joint_7: 15.0

kd_policy:
    joint_1: 15.0
    joint_2: 15.0
    joint_3: 15.0
    joint_4: 15.0
    joint_5: 8.5
    joint_6: 8.5
    joint_7: 8.5

kp_robot:
  joint_1: 100.0
  joint_2: 100.0
  joint_3: 100.0
  joint_4: 100.0
  joint_5: 100.0
  joint_6: 100.0
  joint_7: 100.0

kd_robot:
  joint_1: 14.14
  joint_2: 14.14
  joint_3: 14.14
  joint_4: 14.14
  joint_5: 14.14
  joint_6: 14.14
  joint_7: 14.14

# kp_position:
#   joint_1: 25000
#   joint_2: 25000
#   joint_3: 25000
#   joint_4: 25000
#   joint_5: 15000
#   joint_6: 15000
#   joint_7: 15000

# kd_position:
#   joint_1: 1
#   joint_2: 1
#   joint_3: 1
#   joint_4: 1
#   joint_5: 0.1
#   joint_6: 0.1
#   joint_7: 0.1



# kp:
#   joint_1: 3000
#   joint_2: 50000
#   joint_3: 3000
#   joint_4: 50000
#   joint_5: 750
#   joint_6: 5000
#   joint_7: 100

# kd:
#   joint_1: 2
#   joint_2: 0
#   joint_3: 0
#   joint_4: 0
#   joint_5: 0.2
#   joint_6: 1
#   joint_7: 0

# kp:
#   joint_1: 1500
#   joint_2: 1500
#   joint_3: 1500
#   joint_4: 1500
#   joint_5: 100
#   joint_6: 100
#   joint_7: 100

# kd:
#   joint_1: 25
#   joint_2: 25
#   joint_3: 25
#   joint_4: 25
#   joint_5: 2
#   joint_6: 2
#   joint_7: 2

# kp:
#   joint_1: 5000
#   joint_2: 5000
#   joint_3: 5000
#   joint_4: 5000
#   joint_5: 2000
#   joint_6: 2000
#   joint_7: 2000

# kd:
#   joint_1: 0
#   joint_2: 0
#   joint_3: 0
#   joint_4: 0
#   joint_5: 0
#   joint_6: 0
#   joint_7: 0


